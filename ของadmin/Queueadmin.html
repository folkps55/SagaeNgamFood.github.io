<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Queue Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #f1fff9, #dff7e6);
      color: #333;
    }

    header {
      background: linear-gradient(90deg, #28a745, #20c997);
      color: white;
      text-align: center;
      padding: 25px 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    header h1 {
      margin: 0;
      font-size: 36px;
      font-weight: 600;
    }

    header p {
      margin-top: 6px;
      font-size: 18px;
      opacity: 0.9;
    }

    table {
      width: 90%;
      margin: 30px auto;
      border-collapse: collapse;
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #ddd;
      font-size: 16px;
    }

    th {
      background: #28a745;
      color: white;
      font-size: 16px;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #e8f5e9;
      transition: 0.3s;
    }

    input[type=number], select {
      padding: 6px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .btn {
      display: inline-block;
      margin: 10px 5px;
      padding: 12px 25px;
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      background: linear-gradient(90deg, #28a745, #20c997);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    }

    @media screen and (max-width: 600px) {
      table, th, td {
        font-size: 14px;
      }
      header h1 {
        font-size: 28px;
      }
      header p {
        font-size: 16px;
      }
      .btn {
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>Queue Admin</h1>
    <p>กำหนดราคาคิวลูกค้า</p>
  </header>

  <table>
    <thead>
      <tr>
        <th>เลขคิว</th>
        <th>เมนู</th>
        <th>ท็อปปิ้ง</th>
        <th>สถานะ</th>
        <th>ราคา (บาท)</th>
      </tr>
    </thead>
    <tbody id="queueTable"></tbody>
  </table>

  <div style="text-align:center;">
    <button id="resetBtn" class="btn">รีข้อมูลวันนี้</button>
    <button id="nextMontBtn" class="btn">ดูเงินรายเดือน</button>
  </div>

  <script>
    function renderTable() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let tbody = document.getElementById("queueTable");

      if (orders.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="padding:15px;">ยังไม่มีคำสั่งซื้อ</td></tr>`;
        return;
      }

      tbody.innerHTML = "";
      orders.forEach((order, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${index + 1}</td>
            <td>${order.menu}</td>
            <td>${order.topping || "-"}</td>
            <td>
              <select onchange="updateStatus(${index}, this.value)">
                <option value="รอทำ" ${order.status === "รอทำ" ? "selected" : ""}>รอทำ</option>
                <option value="เสร็จแล้ว" ${order.status === "เสร็จแล้ว" ? "selected" : ""}>เสร็จแล้ว</option>
                <option value="ยกเลิก" ${order.status === "ยกเลิก" ? "selected" : ""}>ยกเลิก</option>
              </select>
            </td>
            <td>
              <input type="number" value="${order.price || ''}" onchange="updatePrice(${index}, this.value)" />
            </td>
          </tr>`;
      });
    }

    function updateStatus(index, value) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders[index].status = value;
      localStorage.setItem("orders", JSON.stringify(orders));
      updateMonthlyIncome();
    }

    function updatePrice(index, value) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders[index].price = Number(value);
      localStorage.setItem("orders", JSON.stringify(orders));
      updateMonthlyIncome();
    }

    function updateMonthlyIncome() {
      Object.keys(localStorage)
        .filter(k => k.startsWith("monthlyData-"))
        .forEach(k => localStorage.removeItem(k));

      let orders = JSON.parse(localStorage.getItem("orders")) || [];

      orders.forEach(order => {
        if (order.status !== "เสร็จแล้ว" || !order.price) return;

        let date = order.date ? new Date(order.date) : new Date();
        let month = String(date.getMonth() + 1).padStart(2, "0");
        let year = date.getFullYear();
        let key = `monthlyData-${year}-${month}`;

        let data = localStorage.getItem(key)
          ? JSON.parse(localStorage.getItem(key))
          : { month, year, income: 0 };

        data.income = parseInt(data.income) + parseInt(order.price);
        localStorage.setItem(key, JSON.stringify(data));
      });
    }

    document.getElementById("resetBtn").addEventListener("click", () => {
      if (confirm("คุณแน่ใจหรือไม่ว่าต้องการล้างข้อมูลคิววันนี้?")) {
        localStorage.setItem("orders", JSON.stringify([]));
        renderTable();
        updateMonthlyIncome();
      }
    });

    document.getElementById('nextMontBtn').addEventListener('click', () => {
      window.location.href = 'MonthlyDataDashboard.html';
    });

    renderTable();
    updateMonthlyIncome();
  </script>

</body>
</html>
